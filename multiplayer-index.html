<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TypeRace - Multiplayer Typing Game</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #000;
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            background: linear-gradient(135deg, #0d0d0d 0%, #1a1a1a 100%);
        }
        
        .container {
            max-width: 1000px;
            width: 100%;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            border-bottom: 2px solid #333;
        }
        
        h1 {
            font-size: 2.8rem;
            background: linear-gradient(90deg, #4CAF50, #2E7D32);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(76, 175, 80, 0.3);
        }
        
        .subtitle {
            color: #bbb;
            font-size: 1.2rem;
            margin-bottom: 20px;
        }
        
        /* Screens */
        .screen {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }
        
        #lobby-screen {
            display: block;
        }
        
        /* Lobby Screen */
        .lobby-container {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .lobby-card {
            background: #111;
            border-radius: 10px;
            padding: 25px;
            width: 300px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            text-align: center;
        }
        
        .lobby-card h2 {
            color: #4CAF50;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #aaa;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px;
            background: #222;
            border: 1px solid #333;
            border-radius: 5px;
            color: white;
            font-size: 1rem;
        }
        
        .btn {
            padding: 12px 25px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            font-size: 1.1rem;
        }
        
        .btn:hover {
            background: #3e8e41;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .btn-secondary {
            background: #555;
        }
        
        .btn-secondary:hover {
            background: #666;
        }
        
        /* Room Screen */
        .room-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #333;
        }
        
        .room-id {
            background: #222;
            padding: 8px 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 1.2rem;
        }
        
        .players-container {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .player-card {
            background: #111;
            border-radius: 10px;
            padding: 20px;
            flex: 1;
            min-width: 200px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .player-card h3 {
            color: #4CAF50;
            margin-bottom: 15px;
        }
        
        .player-status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #555;
        }
        
        .status-dot.ready {
            background: #4CAF50;
            box-shadow: 0 0 10px #4CAF50;
        }
        
        .status-dot.typing {
            background: #2196F3;
            box-shadow: 0 0 10px #2196F3;
        }
        
        /* Game Screen */
        .game-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            align-items: center;
        }
        
        .timer {
            font-size: 2rem;
            font-weight: bold;
            color: #4CAF50;
            font-family: monospace;
        }
        
        .text-display {
            background: #111;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            line-height: 1.8;
            font-size: 1.2rem;
            min-height: 180px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .typing-area {
            margin-bottom: 30px;
        }
        
        textarea {
            width: 100%;
            height: 120px;
            background: #222;
            color: white;
            border: 2px solid #333;
            border-radius: 10px;
            padding: 20px;
            font-size: 1.1rem;
            resize: none;
        }
        
        textarea:focus {
            outline: none;
            border-color: #4CAF50;
        }
        
        .progress-container {
            background: #111;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .progress-bar {
            height: 20px;
            background: #222;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #2E7D32);
            width: 0%;
            transition: width 0.3s;
            border-radius: 10px;
        }
        
        .player-progress {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            color: #aaa;
        }
        
        /* Results Screen */
        .results-container {
            background: #111;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .results-container h2 {
            color: #4CAF50;
            margin-bottom: 25px;
            font-size: 2rem;
        }
        
        .results-stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .stat {
            padding: 20px;
            min-width: 150px;
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #4CAF50;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #aaa;
        }
        
        /* Typing effects */
        .current-char {
            background-color: #333;
            border-radius: 3px;
            padding: 0 2px;
        }
        
        .correct {
            color: #4CAF50;
        }
        
        .incorrect {
            color: #F44336;
            text-decoration: underline;
        }
        
        .fade {
            animation: fade 0.5s ease-in-out;
        }
        
        @keyframes fade {
            0% { background-color: #4CAF50; }
            100% { background-color: transparent; }
        }
        
        .incorrect-fade {
            animation: incorrectFade 0.5s ease-in-out;
        }
        
        @keyframes incorrectFade {
            0% { background-color: #F44336; }
            100% { background-color: transparent; }
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .countdown {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20vw;
            color: #4CAF50;
            z-index: 1000;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        /* Responsive design */
        @media (max-width: 768px) {
            .lobby-container {
                flex-direction: column;
                align-items: center;
            }
            
            .players-container {
                flex-direction: column;
            }
            
            .results-stats {
                flex-direction: column;
                gap: 20px;
            }
            
            h1 {
                font-size: 2.2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-keyboard"></i> TypeRace</h1>
            <p class="subtitle">Test your typing speed against players worldwide</p>
        </header>
        
        <!-- Lobby Screen -->
        <div id="lobby-screen" class="screen">
            <div class="lobby-container">
                <div class="lobby-card">
                    <h2>Create a Game</h2>
                    <div class="form-group">
                        <label for="player-name">Your Name</label>
                        <input type="text" id="player-name" placeholder="Enter your name" value="Player 1">
                    </div>
                    <button id="create-btn" class="btn">Create Room</button>
                </div>
                
                <div class="lobby-card">
                    <h2>Join a Game</h2>
                    <div class="form-group">
                        <label for="join-player-name">Your Name</label>
                        <input type="text" id="join-player-name" placeholder="Enter your name" value="Player 2">
                    </div>
                    <div class="form-group">
                        <label for="room-id">Room Code</label>
                        <input type="text" id="room-id" placeholder="Enter room code">
                    </div>
                    <button id="join-btn" class="btn btn-secondary">Join Room</button>
                </div>
            </div>
        </div>
        
        <!-- Room Screen -->
        <div id="room-screen" class="screen">
            <div class="room-header">
                <h2>Waiting Room</h2>
                <div class="room-id">Room Code: <span id="room-code">ABCD</span></div>
            </div>
            
            <div class="players-container">
                <div class="player-card">
                    <h3>Player 1</h3>
                    <div class="player-status">
                        <div class="status-dot ready"></div>
                        <span>Ready</span>
                    </div>
                </div>
                
                <div class="player-card">
                    <h3>Player 2</h3>
                    <div class="player-status">
                        <div class="status-dot"></div>
                        <span>Not Ready</span>
                    </div>
                </div>
            </div>
            
            <button id="start-btn" class="btn">Start Game</button>
            <button id="leave-btn" class="btn btn-secondary" style="margin-top: 15px;">Leave Room</button>
        </div>
        
        <!-- Game Screen -->
        <div id="game-screen" class="screen">
            <div class="game-header">
                <h2>Typing Race</h2>
                <div class="timer">02:00</div>
            </div>
            
            <div class="text-display">
                <p>This is the text that you need to type. The goal is to type it as quickly and accurately as possible. Your opponent is typing the same text, so be quick!</p>
            </div>
            
            <div class="typing-area">
                <textarea placeholder="Start typing here..."></textarea>
            </div>
            
            <div class="progress-container">
                <h3>Progress</h3>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 30%"></div>
                </div>
                <div class="player-progress">
                    <span>You: 30%</span>
                    <span>Opponent: 45%</span>
                </div>
            </div>
        </div>
        
        <!-- Results Screen -->
        <div id="results-screen" class="screen">
            <div class="results-container">
                <h2>Race Results</h2>
                
                <div class="results-stats">
                    <div class="stat">
                        <div class="stat-value">72</div>
                        <div class="stat-label">WPM</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">98%</div>
                        <div class="stat-label">Accuracy</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">01:32</div>
                        <div class="stat-label">Time</div>
                    </div>
                </div>
                
                <button id="play-again-btn" class="btn">Play Again</button>
                <button id="back-to-lobby-btn" class="btn btn-secondary" style="margin-top: 15px;">Back to Lobby</button>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const screens = {
            lobby: document.getElementById('lobby-screen'),
            room: document.getElementById('room-screen'),
            game: document.getElementById('game-screen'),
            results: document.getElementById('results-screen')
        };
        
        // Buttons
        const createBtn = document.getElementById('create-btn');
        const joinBtn = document.getElementById('join-btn');
        const startBtn = document.getElementById('start-btn');
        const leaveBtn = document.getElementById('leave-btn');
        const playAgainBtn = document.getElementById('play-again-btn');
        const backToLobbyBtn = document.getElementById('back-to-lobby-btn');
        
        // Inputs
        const playerNameInput = document.getElementById('player-name');
        const joinPlayerNameInput = document.getElementById('join-player-name');
        const roomIdInput = document.getElementById('room-id');
        const roomCodeSpan = document.getElementById('room-code');
        
        // Game elements
        const textDisplay = document.querySelector('.text-display');
        const typingArea = document.querySelector('textarea');
        const timerDisplay = document.querySelector('.timer');
        const progressFill = document.querySelector('.progress-fill');
        const playerProgress = document.querySelector('.player-progress');
        
        // Sample text for typing (in a real app, this would come from Wikipedia API)
        const sampleText = "The quick brown fox jumps over the lazy dog. This pangram contains every letter of the English alphabet at least once. Typing practice helps improve your speed and accuracy over time. Many people enjoy typing tests as a way to measure their progress and compete with others. The world record for typing speed is over 200 words per minute, which is incredibly fast!";
        
        // Game state
        let gameState = {
            timeLeft: 120, // 2 minutes in seconds
            timerInterval: null,
            originalText: sampleText,
            currentCharIndex: 0,
            errors: 0,
            startTime: null,
            opponentProgress: 0
        };
        
        // Multiplayer state (simulated for this demo)
        let multiplayerState = {
            roomCode: '',
            players: [
                { name: 'Player 1', ready: true, progress: 0 },
                { name: 'Player 2', ready: false, progress: 0 }
            ]
        };
        
        // Switch screens
        function showScreen(screen) {
            for (const key in screens) {
                screens[key].style.display = 'none';
            }
            screens[screen].style.display = 'block';
        }
        
        // Generate a random room code
        function generateRoomCode() {
            return Math.random().toString(36).substring(2, 6).toUpperCase();
        }
        
        // Initialize the typing text
        function initText() {
            textDisplay.innerHTML = '';
            const paragraph = document.createElement('p');
            
            gameState.originalText.split('').forEach((char, index) => {
                const charSpan = document.createElement('span');
                charSpan.textContent = char;
                paragraph.appendChild(charSpan);
            });
            
            textDisplay.appendChild(paragraph);
            
            // Highlight the first character
            if (textDisplay.querySelector('span')) {
                textDisplay.querySelector('span').classList.add('current-char');
            }
        }
        
        // Start the game timer
        function startTimer() {
            gameState.timerInterval = setInterval(() => {
                gameState.timeLeft--;
                updateTimerDisplay();
                
                if (gameState.timeLeft <= 0) {
                    endGame();
                }
            }, 1000);
        }
        
        // Update timer display
        function updateTimerDisplay() {
            const minutes = Math.floor(gameState.timeLeft / 60);
            const seconds = gameState.timeLeft % 60;
            timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        
        // Update progress bar
        function updateProgress() {
            const progress = (gameState.currentCharIndex / gameState.originalText.length) * 100;
            progressFill.style.width = `${progress}%`;
            
            // Update player progress text
            playerProgress.querySelector('span:first-child').textContent = `You: ${Math.round(progress)}%`;
            
            // Simulate opponent progress (in a real app, this would come from WebSocket)
            const opponentProgress = Math.min(progress + Math.random() * 10, 100);
            playerProgress.querySelector('span:last-child').textContent = `Opponent: ${Math.round(opponentProgress)}%`;
        }
        
        // Handle typing input
        function handleTyping() {
            const typedText = typingArea.value;
            const textSpans = textDisplay.querySelectorAll('span');
            
            gameState.currentCharIndex = typedText.length;
            
            // Reset all spans
            textSpans.forEach(span => {
                span.classList.remove('correct', 'incorrect', 'current-char', 'fade', 'incorrect-fade');
            });
            
            // Check each character
            let allCorrect = true;
            
            for (let i = 0; i < typedText.length; i++) {
                if (i < gameState.originalText.length) {
                    if (typedText[i] === gameState.originalText[i]) {
                        textSpans[i].classList.add('correct');
                        if (i === typedText.length - 1) {
                            textSpans[i].classList.add('fade');
                        }
                    } else {
                        textSpans[i].classList.add('incorrect');
                        if (i === typedText.length - 1) {
                            textSpans[i].classList.add('incorrect-fade');
                        }
                        allCorrect = false;
                        if (i === typedText.length - 1) {
                            gameState.errors++;
                        }
                    }
                }
            }
            
            // Highlight current character
            if (typedText.length < gameState.originalText.length) {
                textSpans[typedText.length].classList.add('current-char');
            }
            
            // Update progress
            updateProgress();
            
            // Check if text is completed
            if (typedText.length === gameState.originalText.length && allCorrect) {
                endGame();
            }
        }
        
        // End the game
        function endGame() {
            clearInterval(gameState.timerInterval);
            typingArea.disabled = true;
            
            // Calculate results
            const endTime = new Date();
            const timeTaken = (endTime - gameState.startTime) / 1000;
            const minutes = timeTaken / 60;
            
            // Calculate WPM (words per minute)
            const words = gameState.originalText.split(' ').length;
            const wpm = Math.round(words / (timeTaken / 60));
            
            // Calculate accuracy
            const totalChars = gameState.originalText.length;
            const accuracy = Math.max(0, Math.round(((totalChars - gameState.errors) / totalChars) * 100));
            
            // Display results
            document.querySelector('.stat-value:nth-child(1)').textContent = wpm;
            document.querySelector('.stat-value:nth-child(2)').textContent = `${accuracy}%`;
            document.querySelector('.stat-value:nth-child(3)').textContent = 
                `${Math.floor(timeTaken / 60)}:${Math.floor(timeTaken % 60).toString().padStart(2, '0')}`;
            
            // Show results screen after a delay
            setTimeout(() => showScreen('results'), 1000);
        }
        
        // Start the game
        function startGame() {
            showScreen('game');
            initText();
            gameState.startTime = new Date();
            gameState.timeLeft = 120;
            gameState.currentCharIndex = 0;
            gameState.errors = 0;
            
            updateTimerDisplay();
            startTimer();
            typingArea.value = '';
            typingArea.disabled = false;
            typingArea.focus();
            
            // Simulate countdown
            const countdown = document.createElement('div');
            countdown.className = 'countdown';
            countdown.textContent = '3';
            document.body.appendChild(countdown);
            
            setTimeout(() => {
                countdown.textContent = '2';
            }, 1000);
            
            setTimeout(() => {
                countdown.textContent = '1';
            }, 2000);
            
            setTimeout(() => {
                document.body.removeChild(countdown);
            }, 3000);
        }
        
        // Event listeners
        createBtn.addEventListener('click', () => {
            const playerName = playerNameInput.value || 'Player 1';
            multiplayerState.players[0].name = playerName;
            multiplayerState.roomCode = generateRoomCode();
            
            roomCodeSpan.textContent = multiplayerState.roomCode;
            showScreen('room');
        });
        
        joinBtn.addEventListener('click', () => {
            const playerName = joinPlayerNameInput.value || 'Player 2';
            const roomCode = roomIdInput.value.toUpperCase();
            
            if (roomCode.length !== 4) {
                alert('Please enter a valid room code (4 characters)');
                return;
            }
            
            multiplayerState.players[1].name = playerName;
            multiplayerState.players[1].ready = true;
            multiplayerState.roomCode = roomCode;
            
            roomCodeSpan.textContent = multiplayerState.roomCode;
            
            // Update player status in UI
            document.querySelectorAll('.player-status .status-dot')[1].classList.add('ready');
            document.querySelectorAll('.player-status span')[1].textContent = 'Ready';
            
            showScreen('room');
        });
        
        startBtn.addEventListener('click', startGame);
        
        leaveBtn.addEventListener('click', () => {
            showScreen('lobby');
        });
        
        playAgainBtn.addEventListener('click', () => {
            startGame();
        });
        
        backToLobbyBtn.addEventListener('click', () => {
            showScreen('lobby');
        });
        
        typingArea.addEventListener('input', handleTyping);
        
        // Initialize
        updateTimerDisplay();
    </script>
</body>
</html>